---
title: "ゆるWeb勉強会@札幌 #29に参加"
emoji: "🐈"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

## クラスメソッド 会場提供 LT

500~700 人規模
DevelopperIO
zenn の運営
月 1 の勉強会：クラメソさっぽろ IT 勉強会(仮) at connpass
コミュニティイベント支援：会場提供

---

## データパイプラインの世界  
Web エンジニアにもわかるデータパイプラインの世界

ELT：Extract(抽出)→Load(読み込み)→Transform(変換)

### データエンジニアは何をしているか

データベースやファイル共有サービス(Notion や GoogleDrive など)からデータウェアハウスに入れる  
データソースを分析軸ごとに各データをまとめたデータウェアハウステーブルにし、最終的な分析結果のマート

dlt  
Python でデータ変換を行うツール

dbt：Data Build Tool  
Select 文だけでデータ分析のためにデータ変換を行うツール

---


## 意味のある成果物

「自分が納得できるもの」を作るのって難しい  
→「作ったものに目的意識がないから？」  
→「目的意識が伴わない物は全部無駄」
→「じゃあ目的って何だったっけ？」

- なぜ使うのか
- どうして作りたいのか
- 毎日使うか
いろいろ

"エンドユーザーが求めているものは？"みたいな話

目的意識がないものは"プロダクトとしては"意味がない  
→勉強としては意味があった

最近やっていること
ピン留を理マインドしてくれるDiscord botを作成 
→ピン留してたものをめっちゃ忘れるから

---

## Github ActionsとAWSをOIDC認証で連携する

CIの仕事はCI環境のみでは成り立たない  
→必ずアプリケーション環境へのアクセスが必要

CI/CDの認証の課題  
アクセスキー管理には漏洩などのセキュリティ課題が多い

OIDC認証
OAuth2.0ベースの認証方法で、トークンで一時的に認証する。
シークレットの管理が不要で一時的な認証情報のみを扱う


1. AWSでIdentity providerを設定
2. IAMロールを作成し、信頼されたエンティティにIdentity providerを登録
    許可するブランチやタグや環境、PRのみ、などの設定もできる

静的な認証情報が不要で柔軟な権限設定ができる

[資料](https://speakerdeck.com/kazuhiro1982/github-actionstoawswooidcren-zheng-delian-xi-suru)

---

## 続・社内LT会を開催することにした！

### なぜやるのか
2024/12/21 ゆるWeb#28 「社内LTを開催することにした！」
会社が部署ごとに交流がなく、3つに別れてる状態  
→月例MTGにでる意欲がない…  
→LT会を開いてみよう！

### イマココ  
過去2回開催できた！  
障壁を下げるためテーマは技術系以外のフリー

### 展望
次はTechテーマで、外部スペースを借りてやりたい  
ファシリテータから外れたためすぼんでいかないようにしたい

---

## FlutterSDK/プラグインのアップデートを自動化した話

### 1. モバイルアプリのCI/CDの構成

CI：静的解析、UnitTest、カバレッジ計測、ファイル生成←GithubActions  
CD：バイナリビルド、バイナリアップロード←Codemagic

### 2. FlutterSDKとプラグインのアップデート作業

今まで手動で行っていたこと
- FVMのFlutterSDKバージョンアップ
- Flutterプラグインのバージョンアップ
- アップデート内容をリリースノートなどで確認
頻度は高くないがタスクは重め

### 3. Renovateによるアップデート

Automated dependency updates. Multi-platform and multi-language.  

特徴
- renovate.jsonで設定を管理、更新しないパッケージを設定できる
- Gem、npm、GoなどFlutter以外のパッケージにも広く対応
- Mend Renovate Appのホスティングを無料利用可能(制約あり)
- MendのページからGithubリポジトリの連携で導入できる

### 4. 成果

1. 更新頻度が増えた
2. SDKやパッケージの変更点をレビューイ自身が調査・要約する必要がなくなった
3. 自動PR作成により既存のCIがアップデート後に自動でチェックやテストを行ってくれる
4. 金銭的・時間的コストが低い

一方課題も…
1. インテグレーションテストやゴールデンテストまで組み合わせて初めて自動化といえる
2. アップデートでコードの修正が必要な場合は手動チェックが必要
3. SDKアップデートが伴うプラグインのアップデートは次のサイクルに後回しになる

マイナーバージョンは自動Mergeしてもいい？

---

## Github ActionsでFlutterアプリのCI/CDをやってます

### Github Actions

Github謹製のワークフロー実行環境  
Ubuntu(x64/arm)、Mac(x64/arm)、Windowsの実行環境が用意されている

### コープさっぽろのCI/CD環境の変遷

無からCircleCI導入  
4年前、アプリの内製化に伴って導入決定  
そもそも、iOSアプリをいい感じにビルドできる選択肢が少なかった
テスト、ビルド、デプロイが自動になることで開発者依存から脱却  
特に、本番用の証明書を開発者が持たなくていい

GithubActionsへ移行  
GithubActonsが高機能化したため移行  
すでにGithubRepositoryで管理していたためユーザ管理が不要  
基本はシェル芸のため移行が難しくない

### FlutterアプリをCI/CDする

iOSとAndrolid両方ビルドしなければいけない 
実行環境のイメージには色々とランタイムがインストール済み、iOSとAndroidのビルド環境あり  
が、FlutterはないのでActionでインストールする

### アプリのビルド手順

1. 開発中の実機検証ビルド
2. リリース前の検証ビルド
3. 申請用の本番ビルド

### 開発中の検証ビルド

開発用ブランチからビルドブランチを派生させている  
両OSともFirebase App Distributionを使っているため、ビルド番号が他のビルドとかぶらないようにしなければいけない

課題 
- ブランチへのpushでビルドされるため、不要なビルドが多い

改善
- ブランチのプッシュ→PRへ特定のラベルを設定 に変更、ビルドのタイミングを管理でき費用削減へ
- ビルド番号を事前に調整→ワークフロー実行中に自動採番 に変更

stepsの前にif文で実行条件のチェックを入れるとそもそもコンテナが立ち上がらないため、より費用削減へ

### リリース前の検証ビルド

devからstgへのマージで実行
- Android：Firebase App Distributionへアップロード・実機配信
- iOS：App Storeアップロード、Testflightで実機配信

### GithubActionsキャッシュ

Actionsのキャッシュ効果範囲を意識する必要がある  
キャッシュを再利用することで実行時間を節約できる

- 基本はブランチ単位
- 派生先ブランチは派生元ブランチのキャッシュを参照可能
- 派生関係のないブランチのキャッシュは参照不可
キャッシュはできるだけ派生元のブランチで持ちたい
